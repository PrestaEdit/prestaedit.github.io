<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PrestaShop 9 : Api d&#39;administration (Admin API) | Blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="alternate" type="application/rss+xml" href="https://prestaedit.github.io/rss.xml" title="Blog RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://prestaedit.github.io/feed.atom" title="Blog Atom Feed">
    <link rel="alternate" type="application/json" href="https://prestaedit.github.io/feed.json" title="Blog JSON Feed">
    <meta name="description" content="Tour d&#39;horizon et tutoriel relatif à la nouvelle API de PrestaShop">
    
    <link rel="preload" href="/assets/css/0.styles.a128e09c.css" as="style"><link rel="preload" href="/assets/js/app.ed9e6311.js" as="script"><link rel="preload" href="/assets/js/6.20402219.js" as="script"><link rel="preload" href="/assets/js/3.d4855d28.js" as="script"><link rel="preload" href="/assets/js/27.97eb3cf8.js" as="script"><link rel="preload" href="/assets/js/8.14af2056.js" as="script"><link rel="preload" href="/assets/js/9.0ace11ef.js" as="script"><link rel="prefetch" href="/assets/js/10.bb2f099b.js"><link rel="prefetch" href="/assets/js/11.3e9d7140.js"><link rel="prefetch" href="/assets/js/12.9c8dc221.js"><link rel="prefetch" href="/assets/js/13.f57a86c2.js"><link rel="prefetch" href="/assets/js/14.b43af2a7.js"><link rel="prefetch" href="/assets/js/15.2ebf831f.js"><link rel="prefetch" href="/assets/js/16.4cff3acc.js"><link rel="prefetch" href="/assets/js/17.975e070b.js"><link rel="prefetch" href="/assets/js/18.1784ef09.js"><link rel="prefetch" href="/assets/js/19.012da42d.js"><link rel="prefetch" href="/assets/js/20.8e21f36d.js"><link rel="prefetch" href="/assets/js/21.f820d3fb.js"><link rel="prefetch" href="/assets/js/22.ae8adf91.js"><link rel="prefetch" href="/assets/js/23.45ca190c.js"><link rel="prefetch" href="/assets/js/24.f82cd95c.js"><link rel="prefetch" href="/assets/js/25.388e0cad.js"><link rel="prefetch" href="/assets/js/26.548acc29.js"><link rel="prefetch" href="/assets/js/28.42bba965.js"><link rel="prefetch" href="/assets/js/29.407cb73e.js"><link rel="prefetch" href="/assets/js/30.b30a3da1.js"><link rel="prefetch" href="/assets/js/31.277e0b5c.js"><link rel="prefetch" href="/assets/js/4.bc18d80a.js"><link rel="prefetch" href="/assets/js/5.20fad23a.js"><link rel="prefetch" href="/assets/js/7.560bedc2.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.49676877.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a128e09c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><nav class="navbar navbar-expand-md navbar-light bg-white fixed-top"><div class="container"><a href="/" class="navbar-brand"><img src="/assets/img/logo.png"> | Blog
          </a> <button type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"><span class="navbar-toggler-icon"></span></button> <div id="navbarsExampleDefault" class="collapse navbar-collapse"><ul class="navbar-nav ml-auto"><li class="nav-item"><a href="/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="./rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></ul></div></div></nav></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="mobile-home-link navbar-brand"><img src="/assets/img/logo.png"> Blog
      </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/">Blog</a></li><li class="mobile-nav-item"><a href="/tag/">Tags</a></li> <li class="mobile-nav-item"><a href="./rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li></ul></div></div></div> <div class="container wrapmain"><div id="vuepress-theme-blog__post-layout" data-v-d07ae2ee><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content" data-v-d07ae2ee><div class="row justify-content-center" data-v-d07ae2ee><div class="col-md-8" data-v-d07ae2ee><header data-v-d07ae2ee><span class="text-muted" data-v-d07ae2ee><div class="post-meta" data-v-d07ae2ee><!----> <div class="post-meta-date"><time pubdate itemprop="datePublished" datetime="2024-06-14T00:00:00.000Z">
      14 juin 2024
    </time></div> <!----></div></span> <h1 itemprop="name headline" class="article-head mt-3" data-v-d07ae2ee>
            PrestaShop 9 : Api d'administration (Admin API)
          </h1> <p class="lead" data-v-d07ae2ee>Tour d'horizon et tutoriel relatif à la nouvelle API de PrestaShop</p> <div class="post-meta" data-v-d07ae2ee><!----> <!----> <div itemprop="keywords" class="card-subheading post-meta-tags"><a href="/tag/PrestaShop 9" data-v-304a57ff> PrestaShop 9 </a><a href="/tag/Tutoriel" data-v-304a57ff> Tutoriel </a></div></div></header></div></div> <div class="row justify-content-center text-center mt-2 mb-2" data-v-d07ae2ee></div> <div class="row justify-content-center" data-v-d07ae2ee><div class="col-md-8" data-v-d07ae2ee><div itemprop="articleBody" class="content__default" data-v-d07ae2ee><div class="alert alert-info">
  Cet article est une version traduite et modifiée du billet de blog &quot;Meet The New API Platform-Based API In PrestaShop 9&quot;
</div> <p>Vous pourrez trouver l'article original sur <a href="https://build.prestashop-project.org/news/2024/meet-prestashop9-api/" target="_blank" rel="noopener noreferrer">ce lien<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="alert alert-warning">
  Mis à jour le 06 novembre 2024.
</div> <h2 id="preambule"><a href="#preambule" class="header-anchor">#</a> Préambule</h2> <p>A la suite de la <a href="https://prestaedit.github.io/2024/06/13/prestashop9-alpha-1/" target="_blank" rel="noopener noreferrer">sortie de la version 9 (Alpha.1)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> de PrestaShop, de nouvelles fonctionnalités font leur apparition.</p> <p>La <strong>nouvelle API</strong> - <em>nommée Api d'administration (Admin API)</em> - est l'une d'elle.</p> <p>Cette version majeure voit sa dépendance principale obtenir une mise à jour de taille : Symfony passe de la version 4.4 à la version <strong>6.4</strong>.</p> <p>Dans la foulée, la version de API Platform utilisée passe de la version 2.7.6 à la version <strong>3.3.6</strong> (<em>3.2.12 au moment de la sortie de l'alpha.1</em>).</p> <p>Cette a été annoncée pour la première fois, durant un <a href="https://youtu.be/jzKBQM3fprY?t=1341" target="_blank" rel="noopener noreferrer">Live Update<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, le <strong>21 juin 2023</strong> et une <a href="https://youtu.be/7CQ2Sg-v4XQ?t=1216" target="_blank" rel="noopener noreferrer">présentation plus fonctionnelle<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> a été réalisée <strong>fin décembre 2023</strong>.</p> <div class="alert alert-info">
  Cette nouvelle API utilise le protocole d'autorisation OAuth et les commandes CQRS pour la gestion des endpoints. Offrant ainsi une gestion plus fine des évènements métiers.
</div> <div class="alert alert-info">
  Le Webservice connu et existant dans PrestaShop peut tourner en parralèle de l'utilisation de cette API.
</div> <h2 id="lexique"><a href="#lexique" class="header-anchor">#</a> Lexique</h2> <p>Afin de faciliter la lecture de ce tutoriel, voici un lexique concernant les principaux concepts du protocole OAuth.</p> <ul><li><strong>Utilisateur (<em>Resource Owner</em>)</strong> : Entité qui a la possibilité de définir les accès à une ressource protégée. Ici, le marchand ayant accès au Back Office.</li> <li><strong>Client</strong> : Application effectuant la requête d'accès des ressources.</li> <li><strong>Jeton (<em>Access Token</em>)</strong> : Token d'accès.</li> <li><strong>Serveur d'autorisation (<em>Authorization Server</em>)</strong> : Chargé d'authentifier le client et de délivrer le jeton.</li> <li><strong>Scope</strong> : Type et périmètre des ressources demandées.</li> <li><strong>JWT Token (<em>Json Web Token</em>)</strong> : Permet l'échange sécurisé de jetons entre plusieurs parties.</li></ul> <h2 id="creation-d-un-client-api"><a href="#creation-d-un-client-api" class="header-anchor">#</a> Création d'un client API</h2> <p>Afin d'ajouter un client API, rendez-vous sur la page <strong>API d'administration</strong> située dans le menu <strong>Paramètres avancés</strong>.</p> <p>Vous trouverez le bouton <strong>Ajouter un nouveau client API</strong> en haut de cette page.</p> <p>Vous pouvez procéder à l'enregistrement de plusieurs clients.</p> <p>Afin de procéder à l'ajout d'un nouveau client, il est nécessaire de renseigner un ensemble d'information à son propos.</p> <img src="/posts/2024-06-14-prestasho9-admin-api/01.png" alt="Capture"> <ul><li><strong>Nom du client</strong> : texte libre. Pour référence interne.</li> <li><strong>ID client</strong> : identifiant unique. Ne doit pas contenir d'espace ou de caractère spécial.</li> <li><strong>Description</strong> : description plus complète du client. Pour référence interne.</li> <li><strong>Durée de vie</strong> : durée de vie du jeton d'accès. En secondes. Par défaut : 3600.</li> <li><strong>Activé</strong> : état du client.</li> <li><strong>Périmètres d'application</strong> : ensemble des périmètres d'applications que le client peut utiliser.</li></ul> <p>Lors de l'enregistrement du formulaire, un secret pour le client sera généré et enregistré en base de données.</p> <p>Celui-ci vous est indiquer dans le message de confirmation.</p> <img src="/posts/2024-06-14-prestasho9-admin-api/02.png" alt="Capture"> <div class="alert alert-warning">
  Cette valeur secrète ne sera affichée qu'une seule fois. N'oubliez pas d'en faire une copie dans un endroit sûr.
</div> <h2 id="octroi-des-informations-d-identification-du-client"><a href="#octroi-des-informations-d-identification-du-client" class="header-anchor">#</a> Octroi des informations d'identification du client</h2> <p>Désormais, vous pouvez réaliser une connexion à l'API.</p> <p>Afin de pouvoir utiliser les périmètres d'applications de notre API via les endpoints prévus à cet effet, nous devons tout d'abord obtenir le <strong>jeton d'accès</strong>.</p> <p>Une requête <strong>POST</strong> sur l'endpoint <code>/admin-api/access_token</code> sera réalisée à cet effet.</p> <p>Elle contiendra les paramètres suivants :</p> <ul><li><strong>client_id</strong> : l'identifiant unique de votre client.</li> <li><strong>client_secret</strong> : le secret généré lors de l'ajout du client.</li> <li><strong>grant_type</strong> : le type d'octroi que vous souhaitez réaliser. Ici, ce sera <code>client_credentials</code>.</li> <li><strong>scope</strong> : les périmètres d'application pour lesquels vous demandez un accès. Vous pouvez en définir plusieurs.</li></ul> <img src="/posts/2024-06-14-prestasho9-admin-api/03.png" alt="Capture"> <p>En guise de réponse, vous obtiendrez un JSON mentionnant le jeton d'accès.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;token_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Bearer&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;expires_in&quot;</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
	<span class="token property">&quot;access_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiJQcmVzdGFFZGl0IiwianRpIjoiZmI2NGUyMjNlNDMyNjc4MjRkOThhNTIyZmQ2NmEyZWEyMjQzYTU3MmViYzQxNDNlMGFjNDdlMDNiZjAwYTA3YWVmOGY5MjBhYmY0OGExNTYiLCJpYXQiOjE3MTgzODQ3MjIuMTY4NzQ0LCJuYmYiOjE3MTgzODQ3MjIuMTY4NzQ2LCJleHAiOjE3MTgzODgzMjIuMTU5ODYzLCJzdWIiOiIiLCJzY29wZXMiOlsiaXNfYXV0aGVudGljYXRlZCIsImN1c3RvbWVyX2dyb3VwX3JlYWQiXX0.sY5zERP_P6VSaUej7lk2uutLjiVX0vW6_fopiKHw_XSpVCbcg_tnV8XaYPgoDj2dXiVLRNPq6C4B1XtcYGTRnAh_ek80fGp-zWWsGS__WsB0gnOd9JDZIkh8DZ9o4Luv1rMriRCk0rODyjyFGEwGUwAeEqeKQT0994ndU-w93cBF5yPOGULFVOvgNIhPOeoGVEwJVOj9YKa58HWoNVgxRSQ8zqRGrLRXAeoXyDlsspu3shVJKX-9uDT3H7QGqWTICdkRu2U-jpBLSUcvGkuMM7ehgqHRT7JDAYAKkFxDps2IK6HDzrPckqmNQDX31pDgh2e8oPOVheBkN8aCWAIJdw&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="alert alert-warning">
  Lorsque vous travaillez en local, dans un environnement non sécurisé, vous otbiendrez l'erreur suivante : Use HTTPS response.
</div> <p>Vous pouvez forcer la désactivation de cette sécurité en désactivation l'option <strong>Forcer la sécurité en mode déboggage</strong>. Cette option est visible lorsque le mode debug est activé.</p> <h3 id="bearer-token"><a href="#bearer-token" class="header-anchor">#</a> Bearer Token</h3> <p>Le jeton qui se cache derrière la propriété <code>access_token</code> est un jeton d'authentification <strong>Bearer</strong>.</p> <p>Vous pourrez dès lors l'utiliser dans vos requêtes destinées à l'API d'administration en authentifiant votre demande.</p> <p>Pour cela, vous devrez fournir l'en-tête <code>Authorization</code> comme suit : <code>Bearer &lt;TOKEN&gt;</code>.</p> <p>Ce jeton est <strong>limité dans le temps</strong> (durée de vie définie lors de la création du client) et une fois celui-ci expiré, il sera nécessaire de relancer l'étape d'accès à l'application.</p> <p>Le jeton est de type <strong>Json Web Token</strong> (JWT) signé avec une clé secrète. Vous pouvez voir le contenu du token en le décodant sur <a href="https://jwt.io" target="_blank" rel="noopener noreferrer">ce site (jwt.io)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="serveur-d-autorisation"><a href="#serveur-d-autorisation" class="header-anchor">#</a> Serveur d'autorisation</h2> <p>Le serveur d'autorisation est responsable de l'adresse des jetons d'accès ainsi que de la validation des clients et des périmètres d'application qui leurs sont attribués.</p> <p>Dans l'approche PrestaShop, le serveur d'autorisation est <strong>construit dans l'API elle-même</strong>.</p> <p>Vous avez toutefois la possibilité de <strong>remplacer</strong> le serveur d'autorisation pré-embarqué par un serveur implémentation l'authentification OAuth2.</p> <p>En exemple, vous pouvez utiliser <a href="https://www.keycloak.org/" target="_blank" rel="noopener noreferrer">Keycloak<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> qui est une solution open-source.</p> <p>PrestaShop fournit également un <a href="https://github.com/PrestaShop/keycloak_connector_demo" target="_blank" rel="noopener noreferrer">module d'exemple<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> permettant l'intégration de <em>Keycloak</em> à <em>PrestaShop</em>.</p> <h2 id="informations-a-propos-du-client-api"><a href="#informations-a-propos-du-client-api" class="header-anchor">#</a> Informations à propos du client API</h2> <p>Afin de tester notre jeton d'accès, nous allons effectuer une requête nous permettant de connaitre les informations de notre client.</p> <p>Pour cela, une requête de type <strong>GET</strong> sera effectuée sur l'endpoint <code>/admin-api/api-client/info</code>.</p> <p>Aucun paramètre n'est requis. Seul l'en-tête mentionnant le token Bearer est nécessaire.</p> <img src="/posts/2024-06-14-prestasho9-admin-api/04.png" alt="Capture"> <p>La réponse obtenue ressemblera à ceci :</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;apiClientId&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token property">&quot;clientId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PrestaEdit&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;clientName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Blog de PrestaEdit&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Une application exemple pour le blog de PrestaEdit&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token property">&quot;lifetime&quot;</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
	<span class="token property">&quot;scopes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">&quot;api_client_read&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;api_client_write&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;cart_rule_write&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;customer_group_read&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;customer_group_write&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;hook_read&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;hook_write&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;module_read&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;module_write&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;product_read&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;product_write&quot;</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="alert alert-warning">
  Les périmères d'application visible dans le retour JSON sont ceux définis pour le client. Ils peuvent varier de ceux attribués au jeton d'accès, si ils ont été modifiés par après.
</div> <h2 id="recuperation-d-une-ressource"><a href="#recuperation-d-une-ressource" class="header-anchor">#</a> Récupération d'une ressource</h2> <p>De la même manière, la récupération d'une ressource se fera en réalisant une requête de type <strong>GET</strong> sur un endpoint donné.</p> <p>L'<strong>identifiant</strong> de la ressource étant communiqué directement dans l'URL.</p> <p>Ainsi, pour récupérer les informations sur le groupe de clients ayant pour identifiant 2, l'URL suivante sera utilisée : <code>/admin-api/customers/group/2</code>.</p> <img src="/posts/2024-06-14-prestasho9-admin-api/05.png" alt="Capture"> <p>Le retour JSON :</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;customerGroupId&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
	<span class="token property">&quot;localizedNames&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Invité&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Guest&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;3&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Guest&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;reductionPercent&quot;</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
	<span class="token property">&quot;displayPriceTaxExcluded&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token property">&quot;showPrice&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token property">&quot;shopIds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token number">1</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="liste-des-ressources-disponibles"><a href="#liste-des-ressources-disponibles" class="header-anchor">#</a> Liste des ressources disponibles</h3> <p>Sur la page d'administration de l'API, vous pourrez visualiser deux liens indiqués dans un message d'information.</p> <p>Le lien au format HTML vous permettra de visualiser les différentes ressources de la boutique.</p> <img src="/posts/2024-06-14-prestasho9-admin-api/06.png" alt="Capture"> <p>Vous pourrez facilement visualiser les <strong>méthodes</strong> et <strong>paramètres</strong> associés à ces ressources.</p> <p>Vous aurez par ailleurs l'occasion de tester les endpoints en renseignant votre jeton d'accès sous la forme <code>Bearer &lt;Token&gt;</code> dans la module disponible via le bouton <strong>Authorize</strong>.</p> <h2 id="edition-d-une-ressource"><a href="#edition-d-une-ressource" class="header-anchor">#</a> Edition d'une ressource</h2> <p>L'édition d'une ressource se réalise sur le même endpoint que la récupération d'une ressource définie, mais en utilisant une méthode <strong>PUT</strong> en lieu et place de la méthode <strong>GET</strong>.</p> <p>Dans le <strong>corps</strong> (body) de la requête, vous passez le JSON des données à modifier.</p> <p>Il n'est <strong>pas nécessaire</strong> de renvoyer le JSON <strong>complet</strong>, tel que reçu durant la récupération.</p> <img src="/posts/2024-06-14-prestasho9-admin-api/07.png" alt="Capture"> <p>Le retour JSON, si l'opération s'est bien déroulée, sera la même que lors de la récupération de la ressource.</p> <p>En Back Office, on peut voir la ressource modifiée.</p> <img src="/posts/2024-06-14-prestasho9-admin-api/08.png" alt="Capture"> <h2 id="ajout-d-une-ressource"><a href="#ajout-d-une-ressource" class="header-anchor">#</a> Ajout d'une ressource</h2> <p>Pour effectuer un ajout, une requête <strong>POST</strong> sera réalisée sur l'endpoint de la ressource souhaitée.</p> <p>L'URL utilisée ne comportera pas d'identifiant particulier.</p> <p>Dans le corps de la requête, vous transmettez le JSON définissant la ressource à ajoutée.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;localizedNames&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Blog&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Blog&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;3&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Blog&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;reductionPercent&quot;</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;displayPriceTaxExcluded&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;showPrice&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;shopIds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token number">1</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Une fois la requête effectuée, vous obtenez le JSON définissant la ressource avec l'identifiant qui lui est associé.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;customerGroupId&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
	<span class="token property">&quot;localizedNames&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Blog&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Blog&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;3&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Blog&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;reductionPercent&quot;</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
	<span class="token property">&quot;displayPriceTaxExcluded&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token property">&quot;showPrice&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token property">&quot;shopIds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token number">1</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Et vous pouvez visualiser la ressource ajoutée en Back Office.</p> <img src="/posts/2024-06-14-prestasho9-admin-api/09.png" alt="Capture"> <h2 id="suppression-d-une-ressource"><a href="#suppression-d-une-ressource" class="header-anchor">#</a> Suppression d'une ressource</h2> <p>La supression d'une ressource s'effectue via une requête <strong>DELETE</strong> sur l'endpoint souhaité.</p> <p>Par exemple, afin de supprimer notre groupe de client nouvellement ajouté, l'URL utilisée sera : <code>/admin-api/customers/group/4</code>.</p> <h2 id="collection-openapi"><a href="#collection-openapi" class="header-anchor">#</a> Collection OpenAPI</h2> <p>Au niveau de la section &quot;Liste des ressources disponibles&quot;, nous avons vu qu'il existait deux formats de documentation disponible.</p> <p>Tandis que nous utilisons le format <strong>HTML</strong> pour visualiser aisément les différents types de ressources, nous pourrons utiliser le format <strong>JSON</strong> pour réaliser un i<strong>mport de la collection</strong> de ressources dans l'application utilisée pour effectuer les requêtes (<em>Postman</em>, <em>Insomnia</em>, ...).</p> <p>Le format de la collection est au format <strong>OpenAPI</strong>.</p> <img src="/posts/2024-06-14-prestasho9-admin-api/10.png" alt="Capture"> <img src="/posts/2024-06-14-prestasho9-admin-api/11.png" alt="Capture"> <img src="/posts/2024-06-14-prestasho9-admin-api/12.png" alt="Capture"> <h2 id="etendre-l-api"><a href="#etendre-l-api" class="header-anchor">#</a> Etendre l'API</h2> <div class="alert alert-info">
  Un des principes fondamentaux de l'API est son extensabilité. Vous pouvez ajouter de nouveaux paramètres d'applications à l'API par le biais d'un module.
</div> <p>Vous pourrez trouver le module exemple sur <a href="https://github.com/PrestaShop/example-modules/tree/master/api_module" target="_blank" rel="noopener noreferrer">ce lien<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ainsi que le module de ressources sur <a href="https://github.com/PrestaShop/ps_apiresources" target="_blank" rel="noopener noreferrer">ce lien<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <img src="/posts/2024-06-14-prestasho9-admin-api/13.png" alt="Capture"> <p>Vous pourrez trouver le module présenté lors de la PrestaShop Developer Conference sur <a href="https://github.com/PrestaEdit/apiexample" target="_blank" rel="noopener noreferrer">ce lien<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="notes"><a href="#notes" class="header-anchor">#</a> Notes</h2> <p>Lorsque vous réaliserez vos tests sur l'API d'administration offerte dans les versions 9 de PrestaShop, vous pourriez être déstabilisé par le nombre de ressources disponibles.</p> <p>Afin de vous rassurez, sachez qu'il ne sera <strong>pas nécessaire de réaliser une mise à jour</strong> de PrestaShop - <em>et donc d'attendre une mise à jour de version</em> - pour <strong>bénéficier de nouveaux endpoints</strong>.</p> <p>Ceux-ci sont définis par l'application du module <code>ps_apiresources</code>.</p> <div class="alert alert-warning">
  Certains points de terminaison sont masqués car marqués comme expérimenteaux. Afin de les rendre disponible, vous devrez cocher l'option Admin API - Activer les points de terminaison expérimentaux dans le menu Fonctionnalités nouvelles et expérimentales.
</div> <h2 id="liens"><a href="#liens" class="header-anchor">#</a> Liens</h2> <p>Désormais, la documentation dédiée aux développeurs sous PrestaShop regorge d'un <a href="https://devdocs.prestashop-project.org/9/admin-api/" target="_blank" rel="noopener noreferrer">chapitre entier<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> sur cette nouvelle fonctionnalité.</p> <p>Vous trouverez également une <a href="https://devdocs.prestashop-project.org/9/admin-api/swagger-doc/" target="_blank" rel="noopener noreferrer">liste des routes disponibles<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> mise à jour automatiquement par le biais d'un export de la commande <code>./bin/console prestashop:generate:apidoc</code>.
Toutes les nouvelles routes ajoutées au module seront automatiquement visibles dans la documentation.</p></div></div></div></article> <div class="row justify-content-center" data-v-d07ae2ee><div class="col-md-9" data-v-d07ae2ee><!----> <!----></div></div> <div class="sticker vuepress-toc" data-v-d07ae2ee><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#preambule" title="Préambule">Préambule</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#lexique" title="Lexique">Lexique</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#creation-d-un-client-api" title="Création d'un client API">Création d'un client API</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#octroi-des-informations-d-identification-du-client" title="Octroi des informations d'identification du client">Octroi des informations d'identification du client</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#bearer-token" title="Bearer Token">Bearer Token</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#serveur-d-autorisation" title="Serveur d'autorisation">Serveur d'autorisation</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#informations-a-propos-du-client-api" title="Informations à propos du client API">Informations à propos du client API</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#recuperation-d-une-ressource" title="Récupération d'une ressource">Récupération d'une ressource</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#liste-des-ressources-disponibles" title="Liste des ressources disponibles">Liste des ressources disponibles</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#edition-d-une-ressource" title="Edition d'une ressource">Edition d'une ressource</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#ajout-d-une-ressource" title="Ajout d'une ressource">Ajout d'une ressource</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#suppression-d-une-ressource" title="Suppression d'une ressource">Suppression d'une ressource</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#collection-openapi" title="Collection OpenAPI">Collection OpenAPI</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#etendre-l-api" title="Etendre l'API">Etendre l'API</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#notes" title="Notes">Notes</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#liens" title="Liens">Liens</a></div></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ed9e6311.js" defer></script><script src="/assets/js/6.20402219.js" defer></script><script src="/assets/js/3.d4855d28.js" defer></script><script src="/assets/js/27.97eb3cf8.js" defer></script><script src="/assets/js/8.14af2056.js" defer></script><script src="/assets/js/9.0ace11ef.js" defer></script>
  </body>
</html>

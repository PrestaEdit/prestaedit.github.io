(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{400:function(e,t,s){"use strict";s.r(t);var r=s(4),a=Object(r.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("Info",{attrs:{title:'Cet article est une version traduite et modifiée du billet de blog "Meet The New API Platform-Based API In PrestaShop 9"'}}),e._v(" "),t("p",[e._v("Vous pourrez trouver l'article original sur "),t("a",{attrs:{href:"https://build.prestashop-project.org/news/2024/meet-prestashop9-api/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ce lien"),t("OutboundLink")],1)]),e._v(" "),t("Warning",{attrs:{title:"Mis à jour le 06 novembre 2024."}}),e._v(" "),t("h2",{attrs:{id:"preambule"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#preambule"}},[e._v("#")]),e._v(" Préambule")]),e._v(" "),t("p",[e._v("A la suite de la "),t("a",{attrs:{href:"https://prestaedit.github.io/2024/06/13/prestashop9-alpha-1/",target:"_blank",rel:"noopener noreferrer"}},[e._v("sortie de la version 9 (Alpha.1)"),t("OutboundLink")],1),e._v(" de PrestaShop, de nouvelles fonctionnalités font leur apparition.")]),e._v(" "),t("p",[e._v("La "),t("strong",[e._v("nouvelle API")]),e._v(" - "),t("em",[e._v("nommée Api d'administration (Admin API)")]),e._v(" - est l'une d'elle.")]),e._v(" "),t("p",[e._v("Cette version majeure voit sa dépendance principale obtenir une mise à jour de taille : Symfony passe de la version 4.4 à la version "),t("strong",[e._v("6.4")]),e._v(".")]),e._v(" "),t("p",[e._v("Dans la foulée, la version de API Platform utilisée passe de la version 2.7.6 à la version "),t("strong",[e._v("3.3.6")]),e._v(" ("),t("em",[e._v("3.2.12 au moment de la sortie de l'alpha.1")]),e._v(").")]),e._v(" "),t("p",[e._v("Cette a été annoncée pour la première fois, durant un "),t("a",{attrs:{href:"https://youtu.be/jzKBQM3fprY?t=1341",target:"_blank",rel:"noopener noreferrer"}},[e._v("Live Update"),t("OutboundLink")],1),e._v(", le "),t("strong",[e._v("21 juin 2023")]),e._v(" et une "),t("a",{attrs:{href:"https://youtu.be/7CQ2Sg-v4XQ?t=1216",target:"_blank",rel:"noopener noreferrer"}},[e._v("présentation plus fonctionnelle"),t("OutboundLink")],1),e._v(" a été réalisée "),t("strong",[e._v("fin décembre 2023")]),e._v(".")]),e._v(" "),t("Info",{attrs:{title:"Cette nouvelle API utilise le protocole d'autorisation OAuth et les commandes CQRS pour la gestion des endpoints. Offrant ainsi une gestion plus fine des évènements métiers."}}),e._v(" "),t("Info",{attrs:{title:"Le Webservice connu et existant dans PrestaShop peut tourner en parralèle de l'utilisation de cette API."}}),e._v(" "),t("h2",{attrs:{id:"lexique"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lexique"}},[e._v("#")]),e._v(" Lexique")]),e._v(" "),t("p",[e._v("Afin de faciliter la lecture de ce tutoriel, voici un lexique concernant les principaux concepts du protocole OAuth.")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Utilisateur ("),t("em",[e._v("Resource Owner")]),e._v(")")]),e._v(" : Entité qui a la possibilité de définir les accès à une ressource protégée. Ici, le marchand ayant accès au Back Office.")]),e._v(" "),t("li",[t("strong",[e._v("Client")]),e._v(" : Application effectuant la requête d'accès des ressources.")]),e._v(" "),t("li",[t("strong",[e._v("Jeton ("),t("em",[e._v("Access Token")]),e._v(")")]),e._v(" : Token d'accès.")]),e._v(" "),t("li",[t("strong",[e._v("Serveur d'autorisation ("),t("em",[e._v("Authorization Server")]),e._v(")")]),e._v(" : Chargé d'authentifier le client et de délivrer le jeton.")]),e._v(" "),t("li",[t("strong",[e._v("Scope")]),e._v(" : Type et périmètre des ressources demandées.")]),e._v(" "),t("li",[t("strong",[e._v("JWT Token ("),t("em",[e._v("Json Web Token")]),e._v(")")]),e._v(" : Permet l'échange sécurisé de jetons entre plusieurs parties.")])]),e._v(" "),t("h2",{attrs:{id:"creation-d-un-client-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#creation-d-un-client-api"}},[e._v("#")]),e._v(" Création d'un client API")]),e._v(" "),t("p",[e._v("Afin d'ajouter un client API, rendez-vous sur la page "),t("strong",[e._v("API d'administration")]),e._v(" située dans le menu "),t("strong",[e._v("Paramètres avancés")]),e._v(".")]),e._v(" "),t("p",[e._v("Vous trouverez le bouton "),t("strong",[e._v("Ajouter un nouveau client API")]),e._v(" en haut de cette page.")]),e._v(" "),t("p",[e._v("Vous pouvez procéder à l'enregistrement de plusieurs clients.")]),e._v(" "),t("p",[e._v("Afin de procéder à l'ajout d'un nouveau client, il est nécessaire de renseigner un ensemble d'information à son propos.")]),e._v(" "),t("img",{attrs:{src:e.$withBase("/posts/2024-06-14-prestasho9-admin-api/01.png"),alt:"Capture"}}),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Nom du client")]),e._v(" : texte libre. Pour référence interne.")]),e._v(" "),t("li",[t("strong",[e._v("ID client")]),e._v(" : identifiant unique. Ne doit pas contenir d'espace ou de caractère spécial.")]),e._v(" "),t("li",[t("strong",[e._v("Description")]),e._v(" : description plus complète du client. Pour référence interne.")]),e._v(" "),t("li",[t("strong",[e._v("Durée de vie")]),e._v(" : durée de vie du jeton d'accès. En secondes. Par défaut : 3600.")]),e._v(" "),t("li",[t("strong",[e._v("Activé")]),e._v(" : état du client.")]),e._v(" "),t("li",[t("strong",[e._v("Périmètres d'application")]),e._v(" : ensemble des périmètres d'applications que le client peut utiliser.")])]),e._v(" "),t("p",[e._v("Lors de l'enregistrement du formulaire, un secret pour le client sera généré et enregistré en base de données.")]),e._v(" "),t("p",[e._v("Celui-ci vous est indiquer dans le message de confirmation.")]),e._v(" "),t("img",{attrs:{src:e.$withBase("/posts/2024-06-14-prestasho9-admin-api/02.png"),alt:"Capture"}}),e._v(" "),t("Warning",{attrs:{title:"Cette valeur secrète ne sera affichée qu'une seule fois. N'oubliez pas d'en faire une copie dans un endroit sûr."}}),e._v(" "),t("h2",{attrs:{id:"octroi-des-informations-d-identification-du-client"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#octroi-des-informations-d-identification-du-client"}},[e._v("#")]),e._v(" Octroi des informations d'identification du client")]),e._v(" "),t("p",[e._v("Désormais, vous pouvez réaliser une connexion à l'API.")]),e._v(" "),t("p",[e._v("Afin de pouvoir utiliser les périmètres d'applications de notre API via les endpoints prévus à cet effet, nous devons tout d'abord obtenir le "),t("strong",[e._v("jeton d'accès")]),e._v(".")]),e._v(" "),t("p",[e._v("Une requête "),t("strong",[e._v("POST")]),e._v(" sur l'endpoint "),t("code",[e._v("/admin-api/access_token")]),e._v(" sera réalisée à cet effet.")]),e._v(" "),t("p",[e._v("Elle contiendra les paramètres suivants :")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("client_id")]),e._v(" : l'identifiant unique de votre client.")]),e._v(" "),t("li",[t("strong",[e._v("client_secret")]),e._v(" : le secret généré lors de l'ajout du client.")]),e._v(" "),t("li",[t("strong",[e._v("grant_type")]),e._v(" : le type d'octroi que vous souhaitez réaliser. Ici, ce sera "),t("code",[e._v("client_credentials")]),e._v(".")]),e._v(" "),t("li",[t("strong",[e._v("scope")]),e._v(" : les périmètres d'application pour lesquels vous demandez un accès. Vous pouvez en définir plusieurs.")])]),e._v(" "),t("img",{attrs:{src:e.$withBase("/posts/2024-06-14-prestasho9-admin-api/03.png"),alt:"Capture"}}),e._v(" "),t("p",[e._v("En guise de réponse, vous obtiendrez un JSON mentionnant le jeton d'accès.")]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"token_type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Bearer"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"expires_in"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3600")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"access_token"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiJQcmVzdGFFZGl0IiwianRpIjoiZmI2NGUyMjNlNDMyNjc4MjRkOThhNTIyZmQ2NmEyZWEyMjQzYTU3MmViYzQxNDNlMGFjNDdlMDNiZjAwYTA3YWVmOGY5MjBhYmY0OGExNTYiLCJpYXQiOjE3MTgzODQ3MjIuMTY4NzQ0LCJuYmYiOjE3MTgzODQ3MjIuMTY4NzQ2LCJleHAiOjE3MTgzODgzMjIuMTU5ODYzLCJzdWIiOiIiLCJzY29wZXMiOlsiaXNfYXV0aGVudGljYXRlZCIsImN1c3RvbWVyX2dyb3VwX3JlYWQiXX0.sY5zERP_P6VSaUej7lk2uutLjiVX0vW6_fopiKHw_XSpVCbcg_tnV8XaYPgoDj2dXiVLRNPq6C4B1XtcYGTRnAh_ek80fGp-zWWsGS__WsB0gnOd9JDZIkh8DZ9o4Luv1rMriRCk0rODyjyFGEwGUwAeEqeKQT0994ndU-w93cBF5yPOGULFVOvgNIhPOeoGVEwJVOj9YKa58HWoNVgxRSQ8zqRGrLRXAeoXyDlsspu3shVJKX-9uDT3H7QGqWTICdkRu2U-jpBLSUcvGkuMM7ehgqHRT7JDAYAKkFxDps2IK6HDzrPckqmNQDX31pDgh2e8oPOVheBkN8aCWAIJdw"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("Warning",{attrs:{title:"Lorsque vous travaillez en local, dans un environnement non sécurisé, vous otbiendrez l'erreur suivante : Use HTTPS response."}}),e._v(" "),t("p",[e._v("Vous pouvez forcer la désactivation de cette sécurité en désactivation l'option "),t("strong",[e._v("Forcer la sécurité en mode déboggage")]),e._v(". Cette option est visible lorsque le mode debug est activé.")]),e._v(" "),t("h3",{attrs:{id:"bearer-token"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bearer-token"}},[e._v("#")]),e._v(" Bearer Token")]),e._v(" "),t("p",[e._v("Le jeton qui se cache derrière la propriété "),t("code",[e._v("access_token")]),e._v(" est un jeton d'authentification "),t("strong",[e._v("Bearer")]),e._v(".")]),e._v(" "),t("p",[e._v("Vous pourrez dès lors l'utiliser dans vos requêtes destinées à l'API d'administration en authentifiant votre demande.")]),e._v(" "),t("p",[e._v("Pour cela, vous devrez fournir l'en-tête "),t("code",[e._v("Authorization")]),e._v(" comme suit : "),t("code",[e._v("Bearer <TOKEN>")]),e._v(".")]),e._v(" "),t("p",[e._v("Ce jeton est "),t("strong",[e._v("limité dans le temps")]),e._v(" (durée de vie définie lors de la création du client) et une fois celui-ci expiré, il sera nécessaire de relancer l'étape d'accès à l'application.")]),e._v(" "),t("p",[e._v("Le jeton est de type "),t("strong",[e._v("Json Web Token")]),e._v(" (JWT) signé avec une clé secrète. Vous pouvez voir le contenu du token en le décodant sur "),t("a",{attrs:{href:"https://jwt.io",target:"_blank",rel:"noopener noreferrer"}},[e._v("ce site (jwt.io)"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"serveur-d-autorisation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#serveur-d-autorisation"}},[e._v("#")]),e._v(" Serveur d'autorisation")]),e._v(" "),t("p",[e._v("Le serveur d'autorisation est responsable de l'adresse des jetons d'accès ainsi que de la validation des clients et des périmètres d'application qui leurs sont attribués.")]),e._v(" "),t("p",[e._v("Dans l'approche PrestaShop, le serveur d'autorisation est "),t("strong",[e._v("construit dans l'API elle-même")]),e._v(".")]),e._v(" "),t("p",[e._v("Vous avez toutefois la possibilité de "),t("strong",[e._v("remplacer")]),e._v(" le serveur d'autorisation pré-embarqué par un serveur implémentation l'authentification OAuth2.")]),e._v(" "),t("p",[e._v("En exemple, vous pouvez utiliser "),t("a",{attrs:{href:"https://www.keycloak.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Keycloak"),t("OutboundLink")],1),e._v(" qui est une solution open-source.")]),e._v(" "),t("p",[e._v("PrestaShop fournit également un "),t("a",{attrs:{href:"https://github.com/PrestaShop/keycloak_connector_demo",target:"_blank",rel:"noopener noreferrer"}},[e._v("module d'exemple"),t("OutboundLink")],1),e._v(" permettant l'intégration de "),t("em",[e._v("Keycloak")]),e._v(" à "),t("em",[e._v("PrestaShop")]),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"informations-a-propos-du-client-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#informations-a-propos-du-client-api"}},[e._v("#")]),e._v(" Informations à propos du client API")]),e._v(" "),t("p",[e._v("Afin de tester notre jeton d'accès, nous allons effectuer une requête nous permettant de connaitre les informations de notre client.")]),e._v(" "),t("p",[e._v("Pour cela, une requête de type "),t("strong",[e._v("GET")]),e._v(" sera effectuée sur l'endpoint "),t("code",[e._v("/admin-api/api-client/info")]),e._v(".")]),e._v(" "),t("p",[e._v("Aucun paramètre n'est requis. Seul l'en-tête mentionnant le token Bearer est nécessaire.")]),e._v(" "),t("img",{attrs:{src:e.$withBase("/posts/2024-06-14-prestasho9-admin-api/04.png"),alt:"Capture"}}),e._v(" "),t("p",[e._v("La réponse obtenue ressemblera à ceci :")]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"apiClientId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"clientId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"PrestaEdit"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"clientName"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Blog de PrestaEdit"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Une application exemple pour le blog de PrestaEdit"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"enabled"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"lifetime"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3600")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"scopes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"api_client_read"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"api_client_write"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"cart_rule_write"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"customer_group_read"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"customer_group_write"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"hook_read"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"hook_write"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"module_read"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"module_write"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"product_read"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"product_write"')]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("Warning",{attrs:{title:"Les périmères d'application visible dans le retour JSON sont ceux définis pour le client. Ils peuvent varier de ceux attribués au jeton d'accès, si ils ont été modifiés par après."}}),e._v(" "),t("h2",{attrs:{id:"recuperation-d-une-ressource"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#recuperation-d-une-ressource"}},[e._v("#")]),e._v(" Récupération d'une ressource")]),e._v(" "),t("p",[e._v("De la même manière, la récupération d'une ressource se fera en réalisant une requête de type "),t("strong",[e._v("GET")]),e._v(" sur un endpoint donné.")]),e._v(" "),t("p",[e._v("L'"),t("strong",[e._v("identifiant")]),e._v(" de la ressource étant communiqué directement dans l'URL.")]),e._v(" "),t("p",[e._v("Ainsi, pour récupérer les informations sur le groupe de clients ayant pour identifiant 2, l'URL suivante sera utilisée : "),t("code",[e._v("/admin-api/customers/group/2")]),e._v(".")]),e._v(" "),t("img",{attrs:{src:e.$withBase("/posts/2024-06-14-prestasho9-admin-api/05.png"),alt:"Capture"}}),e._v(" "),t("p",[e._v("Le retour JSON :")]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"customerGroupId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"localizedNames"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"1"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Invité"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"2"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Guest"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"3"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Guest"')]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"reductionPercent"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"displayPriceTaxExcluded"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"showPrice"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"shopIds"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("h3",{attrs:{id:"liste-des-ressources-disponibles"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#liste-des-ressources-disponibles"}},[e._v("#")]),e._v(" Liste des ressources disponibles")]),e._v(" "),t("p",[e._v("Sur la page d'administration de l'API, vous pourrez visualiser deux liens indiqués dans un message d'information.")]),e._v(" "),t("p",[e._v("Le lien au format HTML vous permettra de visualiser les différentes ressources de la boutique.")]),e._v(" "),t("img",{attrs:{src:e.$withBase("/posts/2024-06-14-prestasho9-admin-api/06.png"),alt:"Capture"}}),e._v(" "),t("p",[e._v("Vous pourrez facilement visualiser les "),t("strong",[e._v("méthodes")]),e._v(" et "),t("strong",[e._v("paramètres")]),e._v(" associés à ces ressources.")]),e._v(" "),t("p",[e._v("Vous aurez par ailleurs l'occasion de tester les endpoints en renseignant votre jeton d'accès sous la forme "),t("code",[e._v("Bearer <Token>")]),e._v(" dans la module disponible via le bouton "),t("strong",[e._v("Authorize")]),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"edition-d-une-ressource"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#edition-d-une-ressource"}},[e._v("#")]),e._v(" Edition d'une ressource")]),e._v(" "),t("p",[e._v("L'édition d'une ressource se réalise sur le même endpoint que la récupération d'une ressource définie, mais en utilisant une méthode "),t("strong",[e._v("PUT")]),e._v(" en lieu et place de la méthode "),t("strong",[e._v("GET")]),e._v(".")]),e._v(" "),t("p",[e._v("Dans le "),t("strong",[e._v("corps")]),e._v(" (body) de la requête, vous passez le JSON des données à modifier.")]),e._v(" "),t("p",[e._v("Il n'est "),t("strong",[e._v("pas nécessaire")]),e._v(" de renvoyer le JSON "),t("strong",[e._v("complet")]),e._v(", tel que reçu durant la récupération.")]),e._v(" "),t("img",{attrs:{src:e.$withBase("/posts/2024-06-14-prestasho9-admin-api/07.png"),alt:"Capture"}}),e._v(" "),t("p",[e._v("Le retour JSON, si l'opération s'est bien déroulée, sera la même que lors de la récupération de la ressource.")]),e._v(" "),t("p",[e._v("En Back Office, on peut voir la ressource modifiée.")]),e._v(" "),t("img",{attrs:{src:e.$withBase("/posts/2024-06-14-prestasho9-admin-api/08.png"),alt:"Capture"}}),e._v(" "),t("h2",{attrs:{id:"ajout-d-une-ressource"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ajout-d-une-ressource"}},[e._v("#")]),e._v(" Ajout d'une ressource")]),e._v(" "),t("p",[e._v("Pour effectuer un ajout, une requête "),t("strong",[e._v("POST")]),e._v(" sera réalisée sur l'endpoint de la ressource souhaitée.")]),e._v(" "),t("p",[e._v("L'URL utilisée ne comportera pas d'identifiant particulier.")]),e._v(" "),t("p",[e._v("Dans le corps de la requête, vous transmettez le JSON définissant la ressource à ajoutée.")]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"localizedNames"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"1"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Blog"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"2"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Blog"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"3"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Blog"')]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"reductionPercent"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"displayPriceTaxExcluded"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"showPrice"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"shopIds"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("p",[e._v("Une fois la requête effectuée, vous obtenez le JSON définissant la ressource avec l'identifiant qui lui est associé.")]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"customerGroupId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"localizedNames"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"1"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Blog"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"2"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Blog"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"3"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Blog"')]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"reductionPercent"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"displayPriceTaxExcluded"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"showPrice"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"shopIds"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("p",[e._v("Et vous pouvez visualiser la ressource ajoutée en Back Office.")]),e._v(" "),t("img",{attrs:{src:e.$withBase("/posts/2024-06-14-prestasho9-admin-api/09.png"),alt:"Capture"}}),e._v(" "),t("h2",{attrs:{id:"suppression-d-une-ressource"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#suppression-d-une-ressource"}},[e._v("#")]),e._v(" Suppression d'une ressource")]),e._v(" "),t("p",[e._v("La supression d'une ressource s'effectue via une requête "),t("strong",[e._v("DELETE")]),e._v(" sur l'endpoint souhaité.")]),e._v(" "),t("p",[e._v("Par exemple, afin de supprimer notre groupe de client nouvellement ajouté, l'URL utilisée sera : "),t("code",[e._v("/admin-api/customers/group/4")]),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"collection-openapi"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#collection-openapi"}},[e._v("#")]),e._v(" Collection OpenAPI")]),e._v(" "),t("p",[e._v('Au niveau de la section "Liste des ressources disponibles", nous avons vu qu\'il existait deux formats de documentation disponible.')]),e._v(" "),t("p",[e._v("Tandis que nous utilisons le format "),t("strong",[e._v("HTML")]),e._v(" pour visualiser aisément les différents types de ressources, nous pourrons utiliser le format "),t("strong",[e._v("JSON")]),e._v(" pour réaliser un i"),t("strong",[e._v("mport de la collection")]),e._v(" de ressources dans l'application utilisée pour effectuer les requêtes ("),t("em",[e._v("Postman")]),e._v(", "),t("em",[e._v("Insomnia")]),e._v(", ...).")]),e._v(" "),t("p",[e._v("Le format de la collection est au format "),t("strong",[e._v("OpenAPI")]),e._v(".")]),e._v(" "),t("img",{attrs:{src:e.$withBase("/posts/2024-06-14-prestasho9-admin-api/10.png"),alt:"Capture"}}),e._v(" "),t("img",{attrs:{src:e.$withBase("/posts/2024-06-14-prestasho9-admin-api/11.png"),alt:"Capture"}}),e._v(" "),t("img",{attrs:{src:e.$withBase("/posts/2024-06-14-prestasho9-admin-api/12.png"),alt:"Capture"}}),e._v(" "),t("h2",{attrs:{id:"etendre-l-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#etendre-l-api"}},[e._v("#")]),e._v(" Etendre l'API")]),e._v(" "),t("Info",{attrs:{title:"Un des principes fondamentaux de l'API est son extensabilité. Vous pouvez ajouter de nouveaux paramètres d'applications à l'API par le biais d'un module."}}),e._v(" "),t("p",[e._v("Vous pourrez trouver le module exemple sur "),t("a",{attrs:{href:"https://github.com/PrestaShop/example-modules/tree/master/api_module",target:"_blank",rel:"noopener noreferrer"}},[e._v("ce lien"),t("OutboundLink")],1),e._v(" ainsi que le module de ressources sur "),t("a",{attrs:{href:"https://github.com/PrestaShop/ps_apiresources",target:"_blank",rel:"noopener noreferrer"}},[e._v("ce lien"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("img",{attrs:{src:e.$withBase("/posts/2024-06-14-prestasho9-admin-api/13.png"),alt:"Capture"}}),e._v(" "),t("p",[e._v("Vous pourrez trouver le module présenté lors de la PrestaShop Developer Conference sur "),t("a",{attrs:{href:"https://github.com/PrestaEdit/apiexample",target:"_blank",rel:"noopener noreferrer"}},[e._v("ce lien"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"notes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#notes"}},[e._v("#")]),e._v(" Notes")]),e._v(" "),t("p",[e._v("Lorsque vous réaliserez vos tests sur l'API d'administration offerte dans les versions 9 de PrestaShop, vous pourriez être déstabilisé par le nombre de ressources disponibles.")]),e._v(" "),t("p",[e._v("Afin de vous rassurez, sachez qu'il ne sera "),t("strong",[e._v("pas nécessaire de réaliser une mise à jour")]),e._v(" de PrestaShop - "),t("em",[e._v("et donc d'attendre une mise à jour de version")]),e._v(" - pour "),t("strong",[e._v("bénéficier de nouveaux endpoints")]),e._v(".")]),e._v(" "),t("p",[e._v("Ceux-ci sont définis par l'application du module "),t("code",[e._v("ps_apiresources")]),e._v(".")]),e._v(" "),t("Warning",{attrs:{title:"Certains points de terminaison sont masqués car marqués comme expérimenteaux. Afin de les rendre disponible, vous devrez cocher l'option Admin API - Activer les points de terminaison expérimentaux dans le menu Fonctionnalités nouvelles et expérimentales."}}),e._v(" "),t("h2",{attrs:{id:"liens"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#liens"}},[e._v("#")]),e._v(" Liens")]),e._v(" "),t("p",[e._v("Désormais, la documentation dédiée aux développeurs sous PrestaShop regorge d'un "),t("a",{attrs:{href:"https://devdocs.prestashop-project.org/9/admin-api/",target:"_blank",rel:"noopener noreferrer"}},[e._v("chapitre entier"),t("OutboundLink")],1),e._v(" sur cette nouvelle fonctionnalité.")]),e._v(" "),t("p",[e._v("Vous trouverez également une "),t("a",{attrs:{href:"https://devdocs.prestashop-project.org/9/admin-api/swagger-doc/",target:"_blank",rel:"noopener noreferrer"}},[e._v("liste des routes disponibles"),t("OutboundLink")],1),e._v(" mise à jour automatiquement par le biais d'un export de la commande "),t("code",[e._v("./bin/console prestashop:generate:apidoc")]),e._v(".\nToutes les nouvelles routes ajoutées au module seront automatiquement visibles dans la documentation.")])],1)}),[],!1,null,null,null);t.default=a.exports}}]);